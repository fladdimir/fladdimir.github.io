<!DOCTYPE html>
<html lang="en-us">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Source Themes Academic 4.8.0">

  

  
  
  
  
  
    
    
    
  
  

  <meta name="author" content="Wladimir Hofmann">

  
  
  
    
  
  <meta name="description" content="Running C code as part of a Python simulation using CFFI">

  
  <link rel="alternate" hreflang="en-us" href="/post/material-flow-control-emulation/">

  


  
  
  
  <meta name="theme-color" content="rgba(255,255,255,0.6)">
  

  
  

  
  
  
  
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css" integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0-1/css/all.min.css" integrity="sha256-4w9DunooKSr3MFXHXWyFER38WmPdm361bQS/2KUWZbU=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">

    
    
    
      
    
    
      
      
        
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/github.min.css" crossorigin="anonymous" title="hl-light" disabled>
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/dracula.min.css" crossorigin="anonymous" title="hl-dark">
        
      
    

    

    

    
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/lazysizes/5.1.2/lazysizes.min.js" integrity="sha256-Md1qLToewPeKjfAHU1zyPwOutccPAm5tahnaw7Osw0A=" crossorigin="anonymous" async></script>
      
    
      

      
      

      
    
      

      
      

      
    
      

      
      
        
      

      
    
      

      
      

      
    

  

  
  
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat:400,700%7CRoboto:400,400italic,700%7CRoboto+Mono&display=swap">
  

  
  
  
  
  <link rel="stylesheet" href="/css/academic.css">

  




  


  

  <link rel="manifest" href="/index.webmanifest">
  <link rel="icon" type="image/png" href="/images/icon_hud653617489d02b724f2e6ae29c68221f_13132_32x32_fill_lanczos_center_2.png">
  <link rel="apple-touch-icon" type="image/png" href="/images/icon_hud653617489d02b724f2e6ae29c68221f_13132_192x192_fill_lanczos_center_2.png">

  <link rel="canonical" href="/post/material-flow-control-emulation/">

  
  
  
  
  
    
  
  
  <meta property="twitter:card" content="summary_large_image">
  
  <meta property="og:site_name" content="Wladimir Hofmann | Homepage">
  <meta property="og:url" content="/post/material-flow-control-emulation/">
  <meta property="og:title" content="Python-based Emulation for Developing Material Flow Controls in C | Wladimir Hofmann | Homepage">
  <meta property="og:description" content="Running C code as part of a Python simulation using CFFI"><meta property="og:image" content="/post/material-flow-control-emulation/featured.jpeg">
  <meta property="twitter:image" content="/post/material-flow-control-emulation/featured.jpeg"><meta property="og:locale" content="en-us">
  
    
      <meta property="article:published_time" content="2021-08-23T00:00:00&#43;00:00">
    
    <meta property="article:modified_time" content="2021-08-23T00:00:00&#43;00:00">
  

  


    






  




<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "/post/material-flow-control-emulation/"
  },
  "headline": "Python-based Emulation for Developing Material Flow Controls in C",
  
  "image": [
    "/post/material-flow-control-emulation/featured.jpeg"
  ],
  
  "datePublished": "2021-08-23T00:00:00Z",
  "dateModified": "2021-08-23T00:00:00Z",
  
  "author": {
    "@type": "Person",
    "name": "Wladimir Hofmann"
  },
  
  "publisher": {
    "@type": "Organization",
    "name": "Wladimir Hofmann | Homepage",
    "logo": {
      "@type": "ImageObject",
      "url": "/images/icon_hud653617489d02b724f2e6ae29c68221f_13132_192x192_fill_lanczos_center_2.png"
    }
  },
  "description": "Running C code as part of a Python simulation using CFFI"
}
</script>

  

  


  


  





  <title>Python-based Emulation for Developing Material Flow Controls in C | Wladimir Hofmann | Homepage</title>

</head>

<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" class="dark">

  <aside class="search-results" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        
        
      </div>

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>


  







<nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id="navbar-main">
  <div class="container">

    
    <div class="d-none d-lg-inline-flex">
      <a class="navbar-brand" href="/">Wladimir Hofmann | Homepage</a>
    </div>
    

    
    <button type="button" class="navbar-toggler" data-toggle="collapse"
            data-target="#navbar-content" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
    <span><i class="fas fa-bars"></i></span>
    </button>
    

    
    <div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none">
      <a class="navbar-brand" href="/">Wladimir Hofmann | Homepage</a>
    </div>
    

    
    
    <div class="navbar-collapse main-menu-item collapse justify-content-start" id="navbar-content">

      
      <ul class="navbar-nav d-md-inline-flex">
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#about"><span>Home</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#experience"><span>Experience</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#projects"><span>Projects</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#publications"><span>Publications</span></a>
        </li>

        
        

      

        
      </ul>
    </div>

    <ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2">
      

      

      

    </ul>

  </div>
</nav>


  <article class="article">

  




















  
  


<div class="article-container pt-3">
  <h1>Python-based Emulation for Developing Material Flow Controls in C</h1>

  
  <p class="page-subtitle">Running C code as part of a Python simulation using CFFI</p>
  

  


<div class="article-metadata">

  
  
  
  
  <div>
    

  
  <span><a href="/authors/fladdimir/">Wladimir Hofmann</a></span>
  </div>
  
  

  
  <span class="article-date">
    
    
      
    
    Aug 23, 2021
  </span>
  

  

  
  <span class="middot-divider"></span>
  <span class="article-reading-time">
    6 min read
  </span>
  

  
  
  

  
  

</div>

  














</div>


<div class="article-header article-container featured-image-wrapper mt-4 mb-4" style="max-width: 660px; max-height: 632px;">
  <div style="position: relative">
    <img src="/post/material-flow-control-emulation/featured.jpeg" alt="" class="featured-image">
    <span class="article-header-caption">Fischertechnik turntable modules</span>
  </div>
</div>



  <div class="article-container">

    <div class="article-style">
      <p>Back at university we had a great time playing around with miniaturized 
<a href="https://en.wikipedia.org/wiki/Fischertechnik" target="_blank" rel="noopener">Fischertechnik</a> conveying systems.
We learned about the challenges of PLC programming and the joy of using 
<a href="https://www.arduino.cc/" target="_blank" rel="noopener">Arduino</a> micro-controller boards to bring conveyor belts and turntables to life.
We were learning about simulation-based controls testing using 
<a href="https://emulate3d.de/" target="_blank" rel="noopener">Emulate3D</a> (awesome 3D physics engine, robot emulations) and 
<a href="https://www.plm.automation.siemens.com/global/de/products/manufacturing-planning/plant-simulation-throughput-optimization.html" target="_blank" rel="noopener">Plant Simulation</a> (also great for testing higher-level controls).<br>
However, the restrictive licensing - USB dongles and notoriously limited pool-licenses - made it challenging to create a simple and accessible controls development workflow suitable for all project team members.</p>
<p>Let&rsquo;s sketch the idea of a material flow simulation environment for developing, debugging and testing C-code inside a Python-based simulation model - non-proprietary and ready to be run anywhere, e.g. as part of CI.</p>
<blockquote>
<p>Public repo: <a href="https://github.com/fladdimir/material-flow-control-c-emulation">https://github.com/fladdimir/material-flow-control-c-emulation</a></p>
</blockquote>
<h2 id="1-scenario--scope">1. Scenario &amp; Scope</h2>
<p>The &ldquo;turntable&rdquo; (image above) represents a typical Fischertechnik conveying module. It consists of 2 motors and 3 sensors:</p>
<ul>
<li>conveyor belt (motor 1)</li>
<li>proximity sensor or photoelectric barrier to identify whether some item is present on the module (sensor 1)</li>
<li>turning unit for changing the belt rotation by 90 degrees (motor 2)</li>
<li>stop position sensors for checking whether the module fully rotated (sensors 2+3, both at 0 and 90 degrees)</li>
</ul>
<p>Even though the motors typically require 24V, relays can be used to control a module with a micro-controller boards typically working at 3-5V pin voltage.
Micro-controller boards such as Arduinos also offer further options for interfacing with other systems via serial communication.</p>
<p>Putting together multiple turntable modules, grid-like conveying layouts can be realized.</p>
<p>However, writing control logic for Arduino can be challenging, especially since debugging code running on a connected board is not as simple.
Additionally, central material flow control software also needs to be tested in interaction with module controls.</p>
<h2 id="2-system-structure">2. System Structure</h2>
<p>A structure for controlling the flow of goods through a grid of connected turntable modules could look like this:</p>
<p><img src="./system_structure-control_structure_2.jpg" alt="system_structure_controls"></p>
<ul>
<li>every turntable&rsquo;s sensors and actors are controlled by a micro-controller (I/O)</li>
<li>every micro-controller has a serial connection to communicate with a central material flow control server</li>
<li>the server logic consists of different parts dedicated to communicating with connected modules, as well as central functions e.g. for pathfinding/routing of items through the system</li>
</ul>
<p>While systems such as 
<a href="https://www.flexlog.de/en/" target="_blank" rel="noopener">Flexconveyor</a> claim to work in a decentralized way without the need for a central &ldquo;routing brain&rdquo;, the described structure tries to shift all functions without hard real-time requirements from the micro-controllers to a central server (which makes particular sense when running on low-budget, resource-constrained boards such as the Arduino Uno).</p>
<h2 id="3-emulation-interfaces">3. Emulation Interfaces</h2>
<p>Within the described setup, every micro-controller interacts with its environment via sensor-reads, actor-writes, and byte-wise serial-reads/writes.
To be able to run the control logic on a development computer, the actual hardware-dependent read/write calls need to be replaced by interactions with simulated counterparts.</p>
<p>One way of achieving that using a Python-based emulation environment and exploiting the simple interfacing with C code could look like this:</p>
<p><img src="./system_structure-emulation_2.jpg" alt="system_structure_emulation"></p>
<ul>
<li>module control C code is called from a Python runtime with help of a generated CFFI wrapper</li>
<li>device-dependent interaction methods are setup to call corresponding Python functions providing simulated inputs/outputs</li>
<li>sensor-reads &amp; actor-writes are run against a shared memory, which is also read/written by a simulation of the physical modules</li>
<li>serial reads &amp; writes are going to a pipe, which represents a connection to the server-side module agent</li>
<li>a dedicated sub-process is created for every module control so that no global C variables are shared between different module controls</li>
</ul>
<p>
<a href="https://cffi.readthedocs.io/en/latest/" target="_blank" rel="noopener">CFFI</a> allows for the simple creation of functions which are declared in C and called from Python, as well as the other way around.
When generating the CFFI wrapper code, C header files can be used to prepare C functions to be called from Python.
To be able to implement forward-declared C functions in Python, the follwing definition can be set:</p>
<pre><code class="language-c">extern &quot;Python+C&quot; bool _light_barrier(); // provide info whether sensor is triggered
</code></pre>
<p>This way, an implementing Python function can then be wired:</p>
<pre><code class="language-py">@ffi.def_extern()
def _light_barrier() -&gt; bool:
    return shared_array[LIGHT_BARRIER_IDX] # simulated value from memory instead of actual sensor
</code></pre>
<h2 id="4-2d-simulation">4. 2D-Simulation</h2>
<p>To be able to emulate physical interactions of the module control code, real system components need to be simulated.
While there are 
<a href="https://projectchrono.org/pychrono/" target="_blank" rel="noopener">Python wrappers</a> for awesome (3D) physics engines such as 
<a href="https://github.com/projectchrono/chrono" target="_blank" rel="noopener">chrono</a>, this implementation just uses a minimal 2D engine with very limited physics.</p>
<p>Supported features include:</p>
<ul>
<li>nested element structures in 2D</li>
<li>cheap collision//overlap detection for certain combinations of simple geometries (rectangles, straights, points)</li>
<li>relative transition and rotation movements of elements and child-elements</li>
<li>movement limits (e.g. to realize max. 90 degrees of rotation for turntables)</li>
</ul>
<p>While an elements global position is determined by its local position relative to the parent-element it is attached to, the global position is cached to avoid recalculation for nested objects in case no position changes occured for any parent element.<br>
The collision detection uses a simple 2-phase check, first checking cheap circumcycles to identify potentially colliding objects before performing a more expensive cohen-sutherland evaluation.
Collisions are used in the simulation e.g. to identify when a box is hitting a light barrier, or which conveyor belt movements are changing a box&rsquo;s position.</p>
<h2 id="5-putting-it-all-together">5. Putting it all together</h2>
<p>The screencast shows an animation of a small sample test scenario consisting of several modules forwarding one box towards randomly chosen target modules (indicated by &lsquo;X&rsquo;):</p>
<p><img src="emulation.gif" alt="c-controlled turntable modules forwarding a box towards randomly chosen targets (indicated by &lsquo;X&rsquo;)"></p>
<p>The visualization is created with help of the 
<a href="https://api.arcade.academy/en/latest/" target="_blank" rel="noopener">Arcade</a> game engine, which allows to simply step forward the simulation inside the game loop and animate the current state.
In addition to the advent of the simulated time, the (C-coded) control loop of each module is invoked sequentially to allow a reaction to potential sensor state changes.</p>
<p>On the server-side of the control hierarchy, the forwarding/receiving of boxes between modules and the awaiting of modules to reach readiness is realized using asyncio coroutines.<br>
The determination of which modules to visit in order to reach a distant target module is done with help of 
<a href="https://networkx.org/" target="_blank" rel="noopener">networkx</a> and a corresponding graph constructed from the module locations.</p>
<blockquote>
<p>The cool thing about all this: we can debug every single layer of the control code at any point in time!</p>
</blockquote>
<p>In addition to normal Python debugging (part of the VS Code Python extension) of the server-side control code, we can attach a C (gcc) debugger to any of the module sub-processes running the C code.<br>
This also works great from within VS Code, where we can even run different debugging sessions at the same time.</p>
<p>Being able to &ldquo;look inside&rdquo; the current state of a C module control makes it amazingly easy to discover bugs, such as the bad evaluation of commands received via serial communication, confirmation serial writes at bad times, plain wrong if-conditions, misplaced early returns etc..</p>
<p>As animation is fully optional, running a &ldquo;headless&rdquo; simulation can be easily used for validating checked-in control code agains a set of defined test scenarios / module layouts e.g. as part of a CI pipeline.</p>
<h3 id="limits-and-shortcomings">Limits and Shortcomings</h3>
<p>Despite the good level of support for development and debugging, there are serious shortcomings of the presented approach, so that there still remains the need for properly testing the complete physical system:</p>
<ul>
<li>C code is run on a normal PC instead of a resource-constrained micro-controller, so e.g. memory usage should be carefully checked</li>
<li>the defined &ldquo;hardware abstraction layer&rdquo; hides the complexity of actual communication hardware and technologies (pins/bus systems/rxtx/i2c/&hellip;)</li>
<li>all control code is invoked sequentially and the simulation waits for all control loops to finish before the next time step, so real-time requirements should be checked with special care on the target hardware</li>
</ul>

    </div>

    







<div class="share-box" aria-hidden="true">
  <ul class="share">
    
      
      
      
        
      
      
      
      <li>
        <a href="https://twitter.com/intent/tweet?url=/post/material-flow-control-emulation/&amp;text=Python-based%20Emulation%20for%20Developing%20Material%20Flow%20Controls%20in%20C" target="_blank" rel="noopener" class="share-btn-twitter">
          <i class="fab fa-twitter"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.facebook.com/sharer.php?u=/post/material-flow-control-emulation/&amp;t=Python-based%20Emulation%20for%20Developing%20Material%20Flow%20Controls%20in%20C" target="_blank" rel="noopener" class="share-btn-facebook">
          <i class="fab fa-facebook"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="mailto:?subject=Python-based%20Emulation%20for%20Developing%20Material%20Flow%20Controls%20in%20C&amp;body=/post/material-flow-control-emulation/" target="_blank" rel="noopener" class="share-btn-email">
          <i class="fas fa-envelope"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.linkedin.com/shareArticle?url=/post/material-flow-control-emulation/&amp;title=Python-based%20Emulation%20for%20Developing%20Material%20Flow%20Controls%20in%20C" target="_blank" rel="noopener" class="share-btn-linkedin">
          <i class="fab fa-linkedin-in"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://web.whatsapp.com/send?text=Python-based%20Emulation%20for%20Developing%20Material%20Flow%20Controls%20in%20C%20/post/material-flow-control-emulation/" target="_blank" rel="noopener" class="share-btn-whatsapp">
          <i class="fab fa-whatsapp"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://service.weibo.com/share/share.php?url=/post/material-flow-control-emulation/&amp;title=Python-based%20Emulation%20for%20Developing%20Material%20Flow%20Controls%20in%20C" target="_blank" rel="noopener" class="share-btn-weibo">
          <i class="fab fa-weibo"></i>
        </a>
      </li>
    
  </ul>
</div>












  
    
    





  
  
  
    
  
  
  
  <div class="media author-card content-widget-hr">
    
      
      <img class="avatar mr-3 avatar-circle" src="/authors/fladdimir/avatar_hu9aec7404c102c7c1af6267bcc4e47f28_382731_270x270_fill_lanczos_center_2.png" alt="Wladimir Hofmann">
    

    <div class="media-body">
      <h5 class="card-title"><a href="/">Wladimir Hofmann</a></h5>
      
      
      <ul class="network-icon" aria-hidden="true">
  
    
    
    
      
    
    
    
    
    
    <li>
      <a href="mailto:fladdi.mir%20[at]%20gmx%20[dot]%20de" >
        <i class="fas fa-envelope"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://github.com/fladdimir" target="_blank" rel="noopener">
        <i class="fab fa-github"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://www.linkedin.com/in/wladimir-hofmann-9065a714b/" target="_blank" rel="noopener">
        <i class="fab fa-linkedin"></i>
      </a>
    </li>
  
    
    
    
    
    
    
    
      
    
    <li>
      <a href="https://www.researchgate.net/profile/Wladimir_Hofmann" target="_blank" rel="noopener">
        <i class="ai ai-researchgate"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://stackoverflow.com/users/13156126/fladdimir" target="_blank" rel="noopener">
        <i class="fab fa-stack-overflow"></i>
      </a>
    </li>
  
</ul>

    </div>
  </div>


  










  
  



  </div>
</article>

      

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js" integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js" integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>

      

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js" integrity="sha256-eOgo0OtLL4cdq7RdwRUiGKLX9XsIJ7nGhWEKbohmVAQ=" crossorigin="anonymous"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/languages/r.min.js"></script>
        
      

    

    
    

    
    
    <script>const code_highlighting = true;</script>
    

    
    
    <script>const isSiteThemeDark = true;</script>
    

    

    
    

    

    
    

    
    

    
    

    
    
    
    
    
    
    
    
    
    
    
    
    <script src="/js/academic.min.6f7ce8be710290b8c431bbc97f405d15.js"></script>

    






  
  
  <div class="container">
    <footer class="site-footer">
  

  <p class="powered-by">
    

    Powered by the
    <a href="https://sourcethemes.com/academic/" target="_blank" rel="noopener">Academic theme</a> for
    <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a>.

    
    <span class="float-right" aria-hidden="true">
      <a href="#" class="back-to-top">
        <span class="button_icon">
          <i class="fas fa-chevron-up fa-2x"></i>
        </span>
      </a>
    </span>
    
  </p>
</footer>

  </div>
  

  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

</body>
</html>
