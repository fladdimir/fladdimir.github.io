<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Credit-Card-Free Web Application Stack for 2022 | wh</title><meta name=keywords content="Java,Quarkus,Heroku,OTLP,Prometheus,Grafana"><meta name=description content="A no-credit-card way of developing, deploying, and monitoring a web application"><meta name=author content><link rel=canonical href=https://fladdimir.github.io/post/stack-2022/><link crossorigin=anonymous href=/assets/css/stylesheet.5cfc680b1eeaeef9efbced92d46c2a9e876b72ee14fba85846afc4cff9e6e6f8.css integrity="sha256-XPxoCx7q7vnvvO2S1Gwqnodrcu4U+6hYRq/Ez/nm5vg=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://fladdimir.github.io/icon.png><link rel=icon type=image/png sizes=16x16 href=https://fladdimir.github.io/icon.png><link rel=icon type=image/png sizes=32x32 href=https://fladdimir.github.io/icon.png><link rel=apple-touch-icon href=https://fladdimir.github.io/apple-touch-icon.png><link rel=mask-icon href=https://fladdimir.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script data-goatcounter=https://fmghio.goatcounter.com/count async src=//gc.zgo.at/count.js></script><meta property="og:title" content="Credit-Card-Free Web Application Stack for 2022"><meta property="og:description" content="A no-credit-card way of developing, deploying, and monitoring a web application"><meta property="og:type" content="article"><meta property="og:url" content="https://fladdimir.github.io/post/stack-2022/"><meta property="article:section" content="post"><meta property="article:published_time" content="2022-02-22T00:00:00+00:00"><meta property="article:modified_time" content="2022-02-22T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Credit-Card-Free Web Application Stack for 2022"><meta name=twitter:description content="A no-credit-card way of developing, deploying, and monitoring a web application"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://fladdimir.github.io/post/"},{"@type":"ListItem","position":2,"name":"Credit-Card-Free Web Application Stack for 2022","item":"https://fladdimir.github.io/post/stack-2022/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Credit-Card-Free Web Application Stack for 2022","name":"Credit-Card-Free Web Application Stack for 2022","description":"A no-credit-card way of developing, deploying, and monitoring a web application","keywords":["Java","Quarkus","Heroku","OTLP","Prometheus","Grafana"],"articleBody":" Update: as of 11/2022 Heroku suspended their free tier offer\nmorling.dev describes render to come close to the Heroku offer, with Postgres databases expiring 90 days after creation\nThis post describes a couple of tools, technologies and services which may be used for developing and operating a full-stack web-application, without the need to show a credit-card anywhere, as of 02/2022. Vendor lock-in’s are avoided as much as possible by aiming to build on established, vendor-independent standards.\nSample app “Collective Color Picking” is a small app illustrating the used technologies. It allows users to pick their favorite color and share it with all other users connected to the same instance.\nThe app consists of a minimal web-frontend, a backend which holds the state (the picked colors of all connected users), and a database which stores the default color.\nGitHub repository: https://github.com/fladdimir/collective-color-picking\nSample-App on Heroku: https://collective-color-picking.herokuapp.com\n(first request may take some seconds, due to a possibly sleeping Heroku dyno)\nApplication structure The app has a standard 3 tier structure.\nClient-side: Vue.js with Typescript, using the radial-color-picker and a canvas to display the picked colors. Websocket connection for sending and receiving color updates.\nServer-side: Quarkus, a growingly popular Java framework built on JEE standards like CDI, JPA, Bean Validation. Websocket support is available. Seamlessly usable with mapstruct, lombok, AssertJ. PostgresQL, widespread and compatible database, locally runnable e.g. via docker.\nFor local development, the vite frontend dev-server can proxy incoming requests to a locally running backend.\nThe actual deployment uses nginx to serve the static client files and proxies /api requests to the backend.\nTests \u0026 CI A useful feature is the option to run Quarkus API tests not only against the application running on Java but also against a native-image, which helps to discover problems like missing @RegisterForReflection annotations on DTOs.\nStatic code analysis tools like sonarqube further help to ensure code quality. Sonarqube analysis can be incorporated into the build via a gradle-plugin, and also supports visualizing the test coverage, which can be obtained by integrating the Quarkus-jacoco-extension.\nThe test and static analysis can be run e.g. on every push to or PR at a remote repository. git-services like GitHub (actions) and GitLab (pipelines) offer free build time on their runners for public projects.\nAnalysis and coverage results can then be submitted to sonarcloud, a sonarqube service which is also freely available for public projects (and offers shiny badges, too).\nHosting \u0026 Deployment Different to major cloud platforms, Heroku offers not only free compute instances (dynos, 512 MB RAM), but also free standard PostgresQL databases (limited rows, size, connections).\nTo be able to switch platforms without extensive configuration changes, the application is provided in form of a docker image, which is pushed to the Heroku registry. Database credentials are provided to a started container via an environment variable (which needs further pre-processing).\nThe application docker image builds on top of the official nginx image and includes the frontend files and the backend in a single image, which can conveniently be created using a multi-stage docker build, so that no build dependencies are included into the final image.\nSince free RAM is limited - and to reduce wake-up time after Heroku dynos were put to sleep - compiling the application backend to a native-image can be beneficial. The native-image compilation requires a large amount of memory (~6 GB for the simple app), but luckily the free build runners of GitHub are able to cope with this.\nThe port on which the application is supposed to listen is also provided by Heroku via environment variable. To configure nginx, the config is generated at runtime from a template with help of envsubst before the start.\nOn update of a dedicated branch, a corresponding GitHub action automatically builds and deploys the image, also including a health-check request after application update.\nMonitoring: Logs \u0026 Metrics For observing the state of a running application, Heroku offers dedicated add-ons for collecting and analyzing logs and a standard metrics collection, which are only available after registering a credit-card.\nTo circumvent this issue, the app uses a dedicated logging and metrics collection setup. All logs \u0026 metrics are sent to a free-tier grafana-cloud instance.\nApplication logs are sent by nginx and the Quarkus backend via syslog to a local grafana-agent, which forwards them to the grafana-cloud loki log database. Since the grafana-agent receives syslog logs only via TCP, and nginx sends syslog logs via UDP, rsyslog is additionally used for protocol translation.\nApart from log-forwarding, the local grafana-agent is also a slimmed-down prometheus in agent mode, which scrapes metrics information from a specified endpoint exposed by the Quarkus metrics extension (/q/metrics). The scraped metrics are then forwarded to the Prometheus instance of grafana-cloud.\nBesides forwarding logs and metrics, the grafana-agent also acts as an OTLP trace receiver which can forward traces created by the Quarkus OTLP extension. Grafana-cloud free-tier includes a Tempo tracing backend.\nThe grafana-cloud connection credentials are provided via environment variables.\nThe complete setup is shown below:\nThe observability backend including grafana components can be setup locally, e.g. using docker-compose, so that the complete setup can be tested locally (which is especially important due to the amount of involved configuration).\n","wordCount":"861","inLanguage":"en","datePublished":"2022-02-22T00:00:00Z","dateModified":"2022-02-22T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://fladdimir.github.io/post/stack-2022/"},"publisher":{"@type":"Organization","name":"wh","logo":{"@type":"ImageObject","url":"https://fladdimir.github.io/icon.png"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://fladdimir.github.io/ accesskey=h title="Home (Alt + H)">Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://fladdimir.github.io/tags/ title=/tags><span>/tags</span></a></li><li><a href=https://fladdimir.github.io/search title="/search (Alt + /)" accesskey=/><span>/search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://fladdimir.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://fladdimir.github.io/post/>Posts</a></div><h1 class=post-title>Credit-Card-Free Web Application Stack for 2022</h1><div class=post-meta><span title='2022-02-22 00:00:00 +0000 UTC'>February 22, 2022</span>&nbsp;·&nbsp;5 min</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#sample-app>Sample app</a></li><li><a href=#application-structure>Application structure</a></li><li><a href=#tests--ci>Tests & CI</a></li><li><a href=#hosting--deployment>Hosting & Deployment</a></li><li><a href=#monitoring-logs--metrics>Monitoring: Logs & Metrics</a></li></ul></nav></div></details></div><div class=post-content><blockquote><p><em>Update: as of 11/2022 Heroku suspended their free tier offer</em></p><p><em><a href=https://www.morling.dev/blog/running-quarkus-native-app-on-render/>morling.dev</a> describes <a href=https://render.com/pricing>render</a> to come close to the Heroku offer, with Postgres databases expiring 90 days after creation</em></p></blockquote><p>This post describes a couple of tools, technologies and services which may be used for developing and operating a full-stack web-application, without the need to show a credit-card anywhere, as of 02/2022.
Vendor lock-in&rsquo;s are avoided as much as possible by aiming to build on established, vendor-independent standards.</p><hr><h2 id=sample-app>Sample app<a hidden class=anchor aria-hidden=true href=#sample-app>#</a></h2><p>&ldquo;Collective Color Picking&rdquo; is a small app illustrating the used technologies. It allows users to pick their favorite color and share it with all other users connected to the same instance.</p><p>The app consists of a minimal web-frontend, a backend which holds the state (the picked colors of all connected users), and a database which stores the default color.</p><p><img loading=lazy src=collective-color-picking.png alt=app-fe></p><blockquote><p>GitHub repository: <a href=https://github.com/fladdimir/collective-color-picking>https://github.com/fladdimir/collective-color-picking</a></p><p>Sample-App on Heroku: <a href=https://collective-color-picking.herokuapp.com>https://collective-color-picking.herokuapp.com</a></p></blockquote><p>(first request may take some seconds, due to a possibly sleeping Heroku dyno)</p><h2 id=application-structure>Application structure<a hidden class=anchor aria-hidden=true href=#application-structure>#</a></h2><p>The app has a standard 3 tier structure.<br>Client-side: <a href=https://vuejs.org/>Vue.js</a> with Typescript, using the <a href=https://www.npmjs.com/package/@radial-color-picker/vue-color-picker>radial-color-picker</a> and a canvas to display the picked colors.
Websocket connection for sending and receiving color updates.</p><p>Server-side: <a href=https://quarkus.io/>Quarkus</a>, a growingly popular Java framework built on JEE standards like CDI, JPA, Bean Validation. <a href=https://quarkus.io/guides/websockets>Websocket support</a> is available.
Seamlessly usable with <a href=https://mapstruct.org/>mapstruct</a>, <a href=https://projectlombok.org/>lombok</a>, <a href=https://assertj.github.io/doc/>AssertJ</a>.
PostgresQL, widespread and compatible database, locally runnable e.g. via <a href=https://hub.docker.com/_/postgres>docker</a>.</p><p>For local development, the <a href=https://vitejs.dev/>vite</a> frontend dev-server can <a href=https://vitejs.dev/config/#server-proxy>proxy incoming requests</a> to a locally running backend.<br>The actual deployment uses <a href=https://www.nginx.com/>nginx</a> to serve the static client files and proxies <code>/api</code> requests to the backend.</p><h2 id=tests--ci>Tests & CI<a hidden class=anchor aria-hidden=true href=#tests--ci>#</a></h2><p>A useful feature is the option to run Quarkus API tests not only against the application running on Java but also against a native-image, which helps to discover problems like missing <code>@RegisterForReflection</code> annotations on DTOs.</p><p>Static code analysis tools like <a href=https://www.sonarqube.org/>sonarqube</a> further help to ensure code quality.
Sonarqube analysis can be incorporated into the build via a gradle-plugin, and also supports visualizing the test coverage, which can be obtained by integrating the <a href=https://quarkus.io/guides/tests-with-coverage#setting-up-jacoco>Quarkus-jacoco-extension</a>.</p><p>The test and static analysis can be run e.g. on every push to or PR at a remote repository. git-services like GitHub (<em>actions</em>) and GitLab (<em>pipelines</em>) offer free build time on their runners for public projects.<br>Analysis and coverage results can then be submitted to <a href=https://sonarcloud.io/>sonarcloud</a>, a sonarqube service which is also freely available for public projects (and offers <a href="https://sonarcloud.io/api/project_badges/measure?project=collective-color-picking&amp;metric=coverage">shiny badges</a>, too).</p><h2 id=hosting--deployment>Hosting & Deployment<a hidden class=anchor aria-hidden=true href=#hosting--deployment>#</a></h2><p>Different to major cloud platforms, <a href=https://www.heroku.com/>Heroku</a> offers not only free compute instances (<em>dynos</em>, 512 MB RAM), but also free standard PostgresQL databases (limited rows, size, connections).</p><p>To be able to switch platforms without extensive configuration changes, the application is provided in form of a docker image, which is pushed to the Heroku registry.
Database credentials are provided to a started container via an environment variable (which needs further <a href=https://github.com/fladdimir/collective-color-picking/blob/a88d05a1152529dad37119a6cea74e1e9b37bbd1/deploy/heroku/prepare_jdbc_url.sh>pre-processing</a>).</p><p>The application docker image builds on top of the official nginx image and includes the frontend files and the backend in a single image, which can conveniently be created using a <a href=https://docs.docker.com/develop/develop-images/multistage-build/>multi-stage docker build</a>, so that no build dependencies are included into the final image.</p><p>Since free RAM is limited - and to reduce wake-up time after Heroku dynos were put to sleep - compiling the application backend to a native-image can be beneficial.
The native-image compilation requires a large amount of memory (~6 GB for the simple app), but luckily the <a href=https://docs.github.com/en/actions/using-github-hosted-runners/about-github-hosted-runners>free build runners of GitHub are able to cope with this</a>.</p><p>The port on which the application is supposed to listen is also provided by Heroku via environment variable. To configure nginx, the config is generated at runtime from a template with help of <a href=https://github.com/fladdimir/collective-color-picking/blob/a88d05a1152529dad37119a6cea74e1e9b37bbd1/Dockerfile#L61>envsubst</a> before the start.</p><p>On update of a dedicated branch, a <a href=https://github.com/marketplace/actions/deploy-to-heroku>corresponding GitHub action</a> automatically builds and deploys the image, also including a health-check request after application update.</p><h2 id=monitoring-logs--metrics>Monitoring: Logs & Metrics<a hidden class=anchor aria-hidden=true href=#monitoring-logs--metrics>#</a></h2><p>For observing the state of a running application, Heroku offers dedicated add-ons for collecting and analyzing <a href=https://elements.heroku.com/addons/#logging>logs</a> and a standard <a href=https://devcenter.heroku.com/articles/metrics>metrics collection</a>, which are <em>only available after registering a credit-card</em>.</p><p>To circumvent this issue, the app uses a dedicated logging and metrics collection setup.
All logs & metrics are sent to a free-tier <a href=https://grafana.com/products/cloud/>grafana-cloud</a> instance.</p><p>Application logs are sent by nginx and the <a href=https://quarkus.io/guides/centralized-log-management>Quarkus backend</a> via syslog to a local <a href=https://github.com/grafana/agent>grafana-agent</a>, which forwards them to the grafana-cloud <a href=https://github.com/grafana/loki>loki</a> log database.
Since the grafana-agent receives syslog logs only via TCP, and nginx sends syslog logs via UDP, <a href=https://www.rsyslog.com/>rsyslog</a> is additionally used for protocol translation.</p><p>Apart from log-forwarding, the local grafana-agent is also a <a href=https://prometheus.io/blog/2021/11/16/agent/>slimmed-down prometheus in agent mode</a>, which scrapes metrics information from a specified endpoint exposed by the <a href=https://quarkus.io/guides/micrometer>Quarkus metrics extension</a> (/q/metrics).
The scraped metrics are then forwarded to the Prometheus instance of grafana-cloud.</p><p>Besides forwarding logs and metrics, the grafana-agent also acts as an OTLP <a href=https://grafana.com/docs/tempo/latest/grafana-agent/>trace receiver</a> which can forward traces created by the <a href=https://quarkus.io/guides/opentelemetry>Quarkus OTLP extension</a>.
Grafana-cloud free-tier includes a <a href=https://github.com/grafana/tempo>Tempo tracing backend</a>.</p><p>The grafana-cloud connection credentials are provided via environment variables.</p><p>The complete setup is shown below:</p><p><img loading=lazy src=logging_metrics.drawio.png alt=observability-setup></p><p>The observability backend including <a href=https://github.com/grafana>grafana components</a> can be <a href=https://github.com/fladdimir/collective-color-picking/tree/a88d05a1152529dad37119a6cea74e1e9b37bbd1/observability/local>setup locally</a>, e.g. using <a href=https://github.com/fladdimir/collective-color-picking/blob/a88d05a1152529dad37119a6cea74e1e9b37bbd1/observability/local/docker-compose.yml>docker-compose</a>, so that the complete setup can be tested locally (which is especially important due to the amount of involved configuration).</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://fladdimir.github.io/tags/java/>Java</a></li><li><a href=https://fladdimir.github.io/tags/quarkus/>Quarkus</a></li><li><a href=https://fladdimir.github.io/tags/heroku/>Heroku</a></li><li><a href=https://fladdimir.github.io/tags/otlp/>OTLP</a></li><li><a href=https://fladdimir.github.io/tags/prometheus/>Prometheus</a></li><li><a href=https://fladdimir.github.io/tags/grafana/>Grafana</a></li></ul><nav class=paginav><a class=prev href=https://fladdimir.github.io/post/document-search/><span class=title>« Prev</span><br><span>Availability and Consistency of an App with Multiple Datasources</span></a>
<a class=next href=https://fladdimir.github.io/post/material-flow-control-emulation/><span class=title>Next »</span><br><span>Python-based Emulation for Developing Material Flow Controls in C</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://fladdimir.github.io/>wh</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>