<!DOCTYPE html>
<html lang="en-us">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Source Themes Academic 4.8.0">

  

  
  
  
  
  
    
    
    
  
  

  <meta name="author" content="Wladimir Hofmann">

  
  
  
    
  
  <meta name="description" content="A simple web-app for sharing geo-locations with friends">

  
  <link rel="alternate" hreflang="en-us" href="/post/location-sharing/">

  


  
  
  
  <meta name="theme-color" content="rgba(255,255,255,0.6)">
  

  
  

  
  
  
  
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css" integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0-1/css/all.min.css" integrity="sha256-4w9DunooKSr3MFXHXWyFER38WmPdm361bQS/2KUWZbU=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">

    
    
    
      
    
    
      
      
        
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/github.min.css" crossorigin="anonymous" title="hl-light" disabled>
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/dracula.min.css" crossorigin="anonymous" title="hl-dark">
        
      
    

    

    

    
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/lazysizes/5.1.2/lazysizes.min.js" integrity="sha256-Md1qLToewPeKjfAHU1zyPwOutccPAm5tahnaw7Osw0A=" crossorigin="anonymous" async></script>
      
    
      

      
      

      
    
      

      
      

      
    
      

      
      
        
      

      
    
      

      
      

      
    

  

  
  
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat:400,700%7CRoboto:400,400italic,700%7CRoboto+Mono&display=swap">
  

  
  
  
  
  <link rel="stylesheet" href="/css/academic.css">

  




  


  

  <link rel="manifest" href="/index.webmanifest">
  <link rel="icon" type="image/png" href="/images/icon_hud653617489d02b724f2e6ae29c68221f_13132_32x32_fill_lanczos_center_2.png">
  <link rel="apple-touch-icon" type="image/png" href="/images/icon_hud653617489d02b724f2e6ae29c68221f_13132_192x192_fill_lanczos_center_2.png">

  <link rel="canonical" href="/post/location-sharing/">

  
  
  
  
  
    
  
  
  <meta property="twitter:card" content="summary_large_image">
  
  <meta property="og:site_name" content="Wladimir Hofmann | Homepage">
  <meta property="og:url" content="/post/location-sharing/">
  <meta property="og:title" content="Playing around with React, Leaflet, Micronaut, Okta, &amp; Heroku | Wladimir Hofmann | Homepage">
  <meta property="og:description" content="A simple web-app for sharing geo-locations with friends"><meta property="og:image" content="/post/location-sharing/featured.png">
  <meta property="twitter:image" content="/post/location-sharing/featured.png"><meta property="og:locale" content="en-us">
  
    
      <meta property="article:published_time" content="2020-12-28T00:00:00&#43;00:00">
    
    <meta property="article:modified_time" content="2020-12-28T00:00:00&#43;00:00">
  

  


    






  




<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "/post/location-sharing/"
  },
  "headline": "Playing around with React, Leaflet, Micronaut, Okta, \u0026 Heroku",
  
  "image": [
    "/post/location-sharing/featured.png"
  ],
  
  "datePublished": "2020-12-28T00:00:00Z",
  "dateModified": "2020-12-28T00:00:00Z",
  
  "author": {
    "@type": "Person",
    "name": "Wladimir Hofmann"
  },
  
  "publisher": {
    "@type": "Organization",
    "name": "Wladimir Hofmann | Homepage",
    "logo": {
      "@type": "ImageObject",
      "url": "/images/icon_hud653617489d02b724f2e6ae29c68221f_13132_192x192_fill_lanczos_center_2.png"
    }
  },
  "description": "A simple web-app for sharing geo-locations with friends"
}
</script>

  

  


  


  <script data-goatcounter="https://fmghio.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>


  <title>Playing around with React, Leaflet, Micronaut, Okta, &amp; Heroku | Wladimir Hofmann | Homepage</title>

</head>

<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" class="dark">

  <aside class="search-results" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="Search..." autocapitalize="off"
        autocomplete="off" autocorrect="off" spellcheck="false" type="search">
        
      </div>

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>


  







<nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id="navbar-main">
  <div class="container">

    
    <div class="d-none d-lg-inline-flex">
      <a class="navbar-brand" href="/">Wladimir Hofmann | Homepage</a>
    </div>
    

    
    <button type="button" class="navbar-toggler" data-toggle="collapse"
            data-target="#navbar-content" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
    <span><i class="fas fa-bars"></i></span>
    </button>
    

    
    <div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none">
      <a class="navbar-brand" href="/">Wladimir Hofmann | Homepage</a>
    </div>
    

    
    
    <div class="navbar-collapse main-menu-item collapse justify-content-start" id="navbar-content">

      
      <ul class="navbar-nav d-md-inline-flex">
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#about"><span>Home</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#experience"><span>Experience</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#projects"><span>Projects</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#publications"><span>Publications</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#connectioncounter"><span># of connected users</span></a>
        </li>

        
        

      

        
      </ul>
    </div>

    <ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2">
      
      <li class="nav-item">
        <a class="nav-link js-search" href="#"><i class="fas fa-search" aria-hidden="true"></i></a>
      </li>
      

      

      

    </ul>

  </div>
</nav>


  <article class="article">

  




















  
  
    
  


<div class="article-container pt-3">
  <h1>Playing around with React, Leaflet, Micronaut, Okta, &amp; Heroku</h1>

  
  <p class="page-subtitle">A simple web-app for sharing geo-locations with friends</p>
  

  


<div class="article-metadata">

  
  
  
  
  <div>
    

  
  <span>Wladimir Hofmann</span>
  </div>
  
  

  
  <span class="article-date">
    
    
      
    
    Dec 28, 2020
  </span>
  

  

  
  <span class="middot-divider"></span>
  <span class="article-reading-time">
    5 min read
  </span>
  

  
  
  

  
  

</div>

  














</div>


<div class="article-header article-container featured-image-wrapper mt-4 mb-4" style="max-width: 720px; max-height: 570px;">
  <div style="position: relative">
    <img src="/post/location-sharing/featured_hu870530dca0f2c2d660ebf4227c201a7b_1571900_720x0_resize_lanczos_2.png" alt="" class="featured-image">
    
  </div>
</div>



  <div class="article-container">

    <div class="article-style">
      <p>Wouldn&rsquo;t it be cool to be able to share your location with friends, but without relying on established service providers, which most probably already know way more about you than they should?</p>
<p>This post will look at a small web-app implementing essential basics of that functionality, using React and Leaflet at the frontend, Micronaut at the backend, Okta as identity provider, and Heroku for free hosting.</p>
<blockquote>
<p>Get the repo: <a href="https://github.com/fladdimir/locsharex">https://github.com/fladdimir/locsharex</a>.</p>
<p>TL;DR - just 
<a href="https://locsharex.herokuapp.com" target="_blank" rel="noopener">show me the app!</a><br>
(first request may take some seconds, due to a possibly sleeping Heroku dyno)</p>
</blockquote>
<hr>
<h2 id="features-and-ui">Features and UI</h2>
<h3 id="login-screen">Login screen</h3>
<p>To get a first impression without sign-up, 3 pre-defined test-users allow you to quickly see the app in action. Just click to login and play around.</p>
<p><img src="img/login.png" alt="login-screen"></p>
<h3 id="okta-login">Okta-Login</h3>
<p>To create your own user, sign-in via Okta, a free Open-ID-Connect identity provider.<br>
(Well, free for any app as long as there are no more than 15k monthly users.)</p>
<p><img src="img/okta.png" alt="okta"></p>
<h3 id="the-map">The Map</h3>
<p>Main screen of the app, where you can see your and your friends&rsquo; locations.<br>
Edit your location by dragging the marker onto the map, stop sharing your position, or rely on your browser/device location (consent needed).
Filter for username in case of searching for someone specific.</p>
<p><img src="img/map.png" alt="map"></p>
<h3 id="settings">Settings</h3>
<p>The contact-administration page, with lots of space for more friends ;)<br>
Look for not-yet-connected people by username, change the name by which people may find you.
Sign-out to try another test-user or check back later.</p>
<p><img src="img/settings.png" alt="settings"></p>
<hr>
<h2 id="technologies">Technologies</h2>
<h3 id="frontend">Frontend</h3>
<p>Single-page 
<a href="https://reactjs.org/" target="_blank" rel="noopener">react</a>-app, created with 
<a href="https://create-react-app.dev/" target="_blank" rel="noopener">create-react-app</a> and 
<a href="https://material-ui.com/" target="_blank" rel="noopener">Material-UI</a>.
Open-street-maps integration with help of 
<a href="https://leafletjs.com/" target="_blank" rel="noopener">leaflet</a> and 
<a href="https://react-leaflet.js.org/" target="_blank" rel="noopener">react-leaflet</a> for simple usage within react components with great 
<a href="https://www.typescriptlang.org/" target="_blank" rel="noopener">typescript</a> support.

<a href="https://code.visualstudio.com/" target="_blank" rel="noopener">VSCode</a>.</p>
<p>Worth mentioning might be the awesome <em>create-react-app</em> tooling, including a proxy-mode for forwarding of <em>/api</em> requests to another locally running server (no cors hustle), and the HTTPS support 
<a href="https://developers.google.com/web/updates/2016/04/geolocation-on-secure-contexts-only" target="_blank" rel="noopener">required for using the geo-location browser api</a>.</p>
<h3 id="backend">Backend</h3>
<p>
<a href="https://micronaut.io/" target="_blank" rel="noopener">Micronaut</a>, a popular JVM-based microservice framework, aiming for lower memory footprints and faster start-up times than Spring-Boot, and (
<a href="https://spring.io/blog/2020/11/23/spring-native-for-graalvm-0-8-3-available-now" target="_blank" rel="noopener">at least currently</a>) still with better support for creating native images with GraalVM (for further start-up time reduction).
Thanks to the 
<a href="https://github.com/redhat-developer/vscode-java" target="_blank" rel="noopener">java-extension</a>, VSCode also provides great support for backend development.</p>
<p>Convenient entity persistence with 
<a href="https://micronaut-projects.github.io/micronaut-data/latest/guide/index.html" target="_blank" rel="noopener">Data Repositories</a> and 
<a href="https://hibernate.org/" target="_blank" rel="noopener">Hibernate</a>.
Below is a simple entity-relationship-model for the app, showing the <code>AppUser</code> with it&rsquo;s app-internal ID, name, (embedded) position, and associated users (m-n self-reference):</p>
<p><img src="img/erm.png" alt="erm"></p>
<p>In addition to the REST-API, Micronaut also provides the possibility to serve static files.</p>
<h3 id="identity-provider">Identity Provider</h3>
<p>
<a href="https://micronaut-projects.github.io/micronaut-security/latest/guide/" target="_blank" rel="noopener">Micronaut Security</a> offers a variety of options for securing an app, including support for <em>OpenID Connect</em>-based authentication flows.
To link persisted user-entities with actual users authenticating via OIDC, the entity also contains information on the identity provider and the <em>sub</em> (a user ID from the identity provider).
That information is only used once during login to identify the logged-in user before issuing a new JWT. No info from the identity-provider is given anywhere but to the database.</p>
<p><em>Micronaut Security</em> includes support for a couple of different OIDC providers out of the box (e.g. Auth0, AWS-Cognito, Okta, Keycloak).</p>
<p>
<a href="https://github.com/keycloak/keycloak" target="_blank" rel="noopener">Keycloak</a> is a popular open-source identity and access management solution, lately starting to move from Wildfly to Quarkus - 
<a href="https://www.keycloak.org/2020/12/first-keycloak-x-release.adoc" target="_blank" rel="noopener">Keycloak-X</a>.
Great for just spinning up a 
<a href="quay.io/keycloak/keycloak-x">container</a> for local development.</p>
<p>Alternatively it is simple to switch to a managed IDP such as 
<a href="https://developer.okta.com/" target="_blank" rel="noopener">Okta</a>.</p>
<p>Shown below is an overview of the application components and their interaction during OIDC login:</p>
<p><img src="img/app.png" alt="setup"></p>
<ol>
<li>The user decides to login and issues a request to initiate the flow</li>
<li>The response redirects to the identity provider</li>
<li>The IDP login is loaded, where the user enters credentials</li>
<li>Upon successful IDP login, the user is redirected to a callback-endpoint of the app (including a one-time code)</li>
<li>The user issues the callback request (including the one-time code)</li>
<li>The app backend makes a secure back-channel request to exchange the user-related one-time code for an ID-token (together with an app-specific, pre-configured client-secret)</li>
<li>The IDP returns an ID-token containing user information</li>
<li>The app backend creates a new JWT containing the app-internal user ID and returns the JWT as an http-only cookie as part of a redirecting response</li>
<li>The browser then sends the cookie with every API request, allowing the backend to validate the JWT and the permission of the user to access requested resources</li>
</ol>
<p>During <em>logout</em> the user needs to clear the existing IDP session as well as the app session, which can be achieved by a series of redirects between the logout endpoints.</p>
<p>See e.g. 
<a href="https://youtu.be/996OiexHze0" target="_blank" rel="noopener">this presentation</a> for an in-depth explanation of OAuth 2 and OIDC.</p>
<h3 id="heroku">Heroku</h3>
<p>
<a href="https://www.heroku.com/" target="_blank" rel="noopener">Heroku</a> is a platform-as-service which offers a simple way to run an app in the cloud, including a free tier of 550 micro instance-hours per month and a postgres-database with a 10k row limit.
Applications can be provided e.g. in form of jars or docker images (the latter may require custom processing of the environment variable storing the Database credentials).
After 30 mins of inactivity without incoming requests, an instance is put to sleep and stops consuming instance-hours.
To quickly respond to a request when waking up an instance, the usage of a 
<a href="https://guides.micronaut.io/micronaut-creating-first-graal-app/guide/index.html" target="_blank" rel="noopener">native image</a> of the app can be beneficial (reducing the app startup time from ~4.1 seconds to ~0.24s).</p>
<hr>
<p>Feel free to register for a free Okta account (no gmail needed), and share your favorite location ;)</p>
<p><a href="https://locsharex.herokuapp.com">https://locsharex.herokuapp.com</a></p>

    </div>

    


















  
    
    





  
  
  
    
  
  
  
  <div class="media author-card content-widget-hr">
    
      
      <img class="avatar mr-3 avatar-circle" src="/authors/fladdimir/avatar_hu9aec7404c102c7c1af6267bcc4e47f28_382731_270x270_fill_lanczos_center_2.png" alt="Wladimir Hofmann">
    

    <div class="media-body">
      <h5 class="card-title"><a href="/">Wladimir Hofmann</a></h5>
      
      
      <ul class="network-icon" aria-hidden="true">
  
    
    
    
      
    
    
    
    
    
    <li>
      <a href="mailto:fladdi.mir@gmx.de" >
        <i class="fas fa-envelope"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://github.com/fladdimir" target="_blank" rel="noopener">
        <i class="fab fa-github"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://www.linkedin.com/in/wladimir-hofmann-9065a714b/" target="_blank" rel="noopener">
        <i class="fab fa-linkedin"></i>
      </a>
    </li>
  
    
    
    
    
    
    
    
      
    
    <li>
      <a href="https://www.researchgate.net/profile/Wladimir_Hofmann" target="_blank" rel="noopener">
        <i class="ai ai-researchgate"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://stackoverflow.com/users/13156126/fladdimir" target="_blank" rel="noopener">
        <i class="fab fa-stack-overflow"></i>
      </a>
    </li>
  
</ul>

    </div>
  </div>


  










  
  



  </div>
</article>

      

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js" integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js" integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>

      

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js" integrity="sha256-eOgo0OtLL4cdq7RdwRUiGKLX9XsIJ7nGhWEKbohmVAQ=" crossorigin="anonymous"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/languages/r.min.js"></script>
        
      

    

    
    

    
    
    <script>const code_highlighting = true;</script>
    

    
    
    <script>const isSiteThemeDark = true;</script>
    

    
    
    
    
    
    
    <script>
      const search_config = {"indexURI":"/index.json","minLength":1,"threshold":0.3};
      const i18n = {"no_results":"No results found","placeholder":"Search...","results":"results found"};
      const content_type = {
        'post': "Posts",
        'project': "Projects",
        'publication' : "Publications",
        'talk' : "Talks"
        };
    </script>
    

    
    

    
    
    <script id="search-hit-fuse-template" type="text/x-template">
      <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
      </div>
    </script>
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js" integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>
    

    
    

    
    

    
    
    
    
    
    
    
    
    
      
    
    
    
    
    <script src="/js/academic.min.37431be2d92d7fb0160054761ab79602.js"></script>

    






  
  
  <div class="container">
    <footer class="site-footer">
  

  <p class="powered-by">
    

    

    
    <span class="float-right" aria-hidden="true">
      <a href="#" class="back-to-top">
        <span class="button_icon">
          <i class="fas fa-chevron-up fa-2x"></i>
        </span>
      </a>
    </span>
    
  </p>
</footer>

  </div>
  

  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

</body>
</html>
