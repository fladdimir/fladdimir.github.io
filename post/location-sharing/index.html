<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Playing around with React, Leaflet, Micronaut, Okta, & Heroku | WH</title><meta name=keywords content="Java,Micronaut,OAuth,React,Leaflet.js"><meta name=description content="A simple web-app for sharing geo-locations with friends"><meta name=author content><link rel=canonical href=https://fladdimir.github.io/post/location-sharing/><link crossorigin=anonymous href=/assets/css/stylesheet.bc1149f4a72aa4858d3a9f71462f75e5884ffe8073ea9d6d5761d5663d651e20.css integrity="sha256-vBFJ9KcqpIWNOp9xRi915YhP/oBz6p1tV2HVZj1lHiA=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://fladdimir.github.io/icon.png><link rel=icon type=image/png sizes=16x16 href=https://fladdimir.github.io/icon.png><link rel=icon type=image/png sizes=32x32 href=https://fladdimir.github.io/icon.png><link rel=apple-touch-icon href=https://fladdimir.github.io/apple-touch-icon.png><link rel=mask-icon href=https://fladdimir.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script data-goatcounter=https://fmghio.goatcounter.com/count async src=//gc.zgo.at/count.js></script><meta property="og:title" content="Playing around with React, Leaflet, Micronaut, Okta, & Heroku"><meta property="og:description" content="A simple web-app for sharing geo-locations with friends"><meta property="og:type" content="article"><meta property="og:url" content="https://fladdimir.github.io/post/location-sharing/"><meta property="og:image" content="https://fladdimir.github.io/post/location-sharing/featured.png"><meta property="article:section" content="post"><meta property="article:published_time" content="2020-12-28T00:00:00+00:00"><meta property="article:modified_time" content="2020-12-28T00:00:00+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://fladdimir.github.io/post/location-sharing/featured.png"><meta name=twitter:title content="Playing around with React, Leaflet, Micronaut, Okta, & Heroku"><meta name=twitter:description content="A simple web-app for sharing geo-locations with friends"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://fladdimir.github.io/post/"},{"@type":"ListItem","position":2,"name":"Playing around with React, Leaflet, Micronaut, Okta, \u0026 Heroku","item":"https://fladdimir.github.io/post/location-sharing/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Playing around with React, Leaflet, Micronaut, Okta, \u0026 Heroku","name":"Playing around with React, Leaflet, Micronaut, Okta, \u0026 Heroku","description":"A simple web-app for sharing geo-locations with friends","keywords":["Java","Micronaut","OAuth","React","Leaflet.js"],"articleBody":"Wouldn’t it be cool to be able to share your location with friends, but without relying on established service providers, which most probably already know way more about you than they should?\nThis post will look at a small web-app implementing essential basics of that functionality, using React and Leaflet at the frontend, Micronaut at the backend, Okta as identity provider, and Heroku for free hosting.\nGet the repo: https://github.com/fladdimir/locsharex.\nTL;DR - just show me the app!\n(first request may take some seconds, due to a possibly sleeping Heroku dyno)\nUpdate: as of 11/2022 Heroku suspended their free tier offer\nFeatures and UI Login screen To get a first impression without sign-up, 3 pre-defined test-users allow you to quickly see the app in action. Just click to login and play around.\nOkta-Login To create your own user, sign-in via Okta, a free Open-ID-Connect identity provider.\n(Well, free for any app as long as there are no more than 15k monthly users.)\nThe Map Main screen of the app, where you can see your and your friends’ locations.\nEdit your location by dragging the marker onto the map, stop sharing your position, or rely on your browser/device location (consent needed). Filter for username in case of searching for someone specific.\nSettings The contact-administration page, with lots of space for more friends ;)\nLook for not-yet-connected people by username, change the name by which people may find you. Sign-out to try another test-user or check back later.\nTechnologies Frontend Single-page react-app, created with create-react-app and Material-UI. Open-street-maps integration with help of leaflet and react-leaflet for simple usage within react components with great typescript support. VSCode.\nWorth mentioning might be the awesome create-react-app tooling, including a proxy-mode for forwarding of /api requests to another locally running server (no cors hustle), and the HTTPS support required for using the geo-location browser api.\nBackend Micronaut, a popular JVM-based microservice framework, aiming for lower memory footprints and faster start-up times than Spring-Boot, and (at least currently) still with better support for creating native images with GraalVM (for further start-up time reduction). Thanks to the java-extension, VSCode also provides great support for backend development.\nConvenient entity persistence with Data Repositories and Hibernate. Below is a simple entity-relationship-model for the app, showing the AppUser with it’s app-internal ID, name, (embedded) position, and associated users (m-n self-reference):\nIn addition to the REST-API, Micronaut also provides the possibility to serve static files.\nIdentity Provider Micronaut Security offers a variety of options for securing an app, including support for OpenID Connect-based authentication flows. To link persisted user-entities with actual users authenticating via OIDC, the entity also contains information on the identity provider and the sub (a user ID from the identity provider). That information is only used once during login to identify the logged-in user before issuing a new JWT. No info from the identity-provider is given anywhere but to the database.\nMicronaut Security includes support for a couple of different OIDC providers out of the box (e.g. Auth0, AWS-Cognito, Okta, Keycloak).\nKeycloak is a popular open-source identity and access management solution, lately starting to move from Wildfly to Quarkus - Keycloak-X. Great for just spinning up a container for local development.\nAlternatively it is simple to switch to a managed IDP such as Okta.\nShown below is an overview of the application components and their interaction during OIDC login:\nThe user decides to login and issues a request to initiate the flow The response redirects to the identity provider The IDP login is loaded, where the user enters credentials Upon successful IDP login, the user is redirected to a callback-endpoint of the app (including a one-time code) The user issues the callback request (including the one-time code) The app backend makes a secure back-channel request to exchange the user-related one-time code for an ID-token (together with an app-specific, pre-configured client-secret) The IDP returns an ID-token containing user information The app backend creates a new JWT containing the app-internal user ID and returns the JWT as an http-only cookie as part of a redirecting response The browser then sends the cookie with every API request, allowing the backend to validate the JWT and the permission of the user to access requested resources During logout the user needs to clear the existing IDP session as well as the app session, which can be achieved by a series of redirects between the logout endpoints.\nSee e.g. this presentation for an in-depth explanation of OAuth 2 and OIDC.\nHeroku Heroku is a platform-as-service which offers a simple way to run an app in the cloud, including a free tier of 550 micro instance-hours per month and a postgres-database with a 10k row limit. Applications can be provided e.g. in form of jars or docker images (the latter may require custom processing of the environment variable storing the Database credentials). After 30 mins of inactivity without incoming requests, an instance is put to sleep and stops consuming instance-hours. To quickly respond to a request when waking up an instance, the usage of a native image of the app can be beneficial (reducing the app startup time from ~4.1 seconds to ~0.24s).\n","wordCount":"856","inLanguage":"en","datePublished":"2020-12-28T00:00:00Z","dateModified":"2020-12-28T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://fladdimir.github.io/post/location-sharing/"},"publisher":{"@type":"Organization","name":"WH","logo":{"@type":"ImageObject","url":"https://fladdimir.github.io/icon.png"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://fladdimir.github.io/ accesskey=h title="Home (Alt + H)">Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://fladdimir.github.io/tags/ title=/tags><span>/tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://fladdimir.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://fladdimir.github.io/post/>Posts</a></div><h1 class=post-title>Playing around with React, Leaflet, Micronaut, Okta, & Heroku</h1><div class=post-meta><span title='2020-12-28 00:00:00 +0000 UTC'>December 28, 2020</span>&nbsp;·&nbsp;5 min</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#features-and-ui>Features and UI</a><ul><li><a href=#login-screen>Login screen</a></li><li><a href=#okta-login>Okta-Login</a></li><li><a href=#the-map>The Map</a></li><li><a href=#settings>Settings</a></li></ul></li><li><a href=#technologies>Technologies</a><ul><li><a href=#frontend>Frontend</a></li><li><a href=#backend>Backend</a></li><li><a href=#identity-provider>Identity Provider</a></li><li><a href=#heroku>Heroku</a></li></ul></li></ul></nav></div></details></div><div class=post-content><p>Wouldn&rsquo;t it be cool to be able to share your location with friends, but without relying on established service providers, which most probably already know way more about you than they should?</p><p>This post will look at a small web-app implementing essential basics of that functionality, using React and Leaflet at the frontend, Micronaut at the backend, Okta as identity provider, and Heroku for free hosting.</p><blockquote><p>Get the repo: <a href=https://github.com/fladdimir/locsharex>https://github.com/fladdimir/locsharex</a>.</p><p>TL;DR - just <a href=https://locsharex.herokuapp.com>show me the app!</a><br>(first request may take some seconds, due to a possibly sleeping Heroku dyno)</p><p><em>Update: as of 11/2022 Heroku suspended their free tier offer</em></p></blockquote><p><img loading=lazy src=featured.png alt=featured></p><hr><h2 id=features-and-ui>Features and UI<a hidden class=anchor aria-hidden=true href=#features-and-ui>#</a></h2><h3 id=login-screen>Login screen<a hidden class=anchor aria-hidden=true href=#login-screen>#</a></h3><p>To get a first impression without sign-up, 3 pre-defined test-users allow you to quickly see the app in action. Just click to login and play around.</p><p><img loading=lazy src=img/login.png alt=login-screen></p><h3 id=okta-login>Okta-Login<a hidden class=anchor aria-hidden=true href=#okta-login>#</a></h3><p>To create your own user, sign-in via Okta, a free Open-ID-Connect identity provider.<br>(Well, free for any app as long as there are no more than 15k monthly users.)</p><p><img loading=lazy src=img/okta.png alt=okta></p><h3 id=the-map>The Map<a hidden class=anchor aria-hidden=true href=#the-map>#</a></h3><p>Main screen of the app, where you can see your and your friends&rsquo; locations.<br>Edit your location by dragging the marker onto the map, stop sharing your position, or rely on your browser/device location (consent needed).
Filter for username in case of searching for someone specific.</p><p><img loading=lazy src=img/map.png alt=map></p><h3 id=settings>Settings<a hidden class=anchor aria-hidden=true href=#settings>#</a></h3><p>The contact-administration page, with lots of space for more friends ;)<br>Look for not-yet-connected people by username, change the name by which people may find you.
Sign-out to try another test-user or check back later.</p><p><img loading=lazy src=img/settings.png alt=settings></p><hr><h2 id=technologies>Technologies<a hidden class=anchor aria-hidden=true href=#technologies>#</a></h2><h3 id=frontend>Frontend<a hidden class=anchor aria-hidden=true href=#frontend>#</a></h3><p>Single-page <a href=https://reactjs.org/>react</a>-app, created with <a href=https://create-react-app.dev/>create-react-app</a> and <a href=https://material-ui.com/>Material-UI</a>.
Open-street-maps integration with help of <a href=https://leafletjs.com/>leaflet</a> and <a href=https://react-leaflet.js.org/>react-leaflet</a> for simple usage within react components with great <a href=https://www.typescriptlang.org/>typescript</a> support.
<a href=https://code.visualstudio.com/>VSCode</a>.</p><p>Worth mentioning might be the awesome <em>create-react-app</em> tooling, including a proxy-mode for forwarding of <em>/api</em> requests to another locally running server (no cors hustle), and the HTTPS support <a href=https://developers.google.com/web/updates/2016/04/geolocation-on-secure-contexts-only>required for using the geo-location browser api</a>.</p><h3 id=backend>Backend<a hidden class=anchor aria-hidden=true href=#backend>#</a></h3><p><a href=https://micronaut.io/>Micronaut</a>, a popular JVM-based microservice framework, aiming for lower memory footprints and faster start-up times than Spring-Boot, and (<a href=https://spring.io/blog/2020/11/23/spring-native-for-graalvm-0-8-3-available-now>at least currently</a>) still with better support for creating native images with GraalVM (for further start-up time reduction).
Thanks to the <a href=https://github.com/redhat-developer/vscode-java>java-extension</a>, VSCode also provides great support for backend development.</p><p>Convenient entity persistence with <a href=https://micronaut-projects.github.io/micronaut-data/latest/guide/index.html>Data Repositories</a> and <a href=https://hibernate.org/>Hibernate</a>.
Below is a simple entity-relationship-model for the app, showing the <code>AppUser</code> with it&rsquo;s app-internal ID, name, (embedded) position, and associated users (m-n self-reference):</p><p><img loading=lazy src=img/erm.png alt=erm></p><p>In addition to the REST-API, Micronaut also provides the possibility to serve static files.</p><h3 id=identity-provider>Identity Provider<a hidden class=anchor aria-hidden=true href=#identity-provider>#</a></h3><p><a href=https://micronaut-projects.github.io/micronaut-security/latest/guide/>Micronaut Security</a> offers a variety of options for securing an app, including support for <em>OpenID Connect</em>-based authentication flows.
To link persisted user-entities with actual users authenticating via OIDC, the entity also contains information on the identity provider and the <em>sub</em> (a user ID from the identity provider).
That information is only used once during login to identify the logged-in user before issuing a new JWT. No info from the identity-provider is given anywhere but to the database.</p><p><em>Micronaut Security</em> includes support for a couple of different OIDC providers out of the box (e.g. Auth0, AWS-Cognito, Okta, Keycloak).</p><p><a href=https://github.com/keycloak/keycloak>Keycloak</a> is a popular open-source identity and access management solution, lately starting to move from Wildfly to Quarkus - <a href=https://www.keycloak.org/2020/12/first-keycloak-x-release.adoc>Keycloak-X</a>.
Great for just spinning up a <a href=quay.io/keycloak/keycloak-x>container</a> for local development.</p><p>Alternatively it is simple to switch to a managed IDP such as <a href=https://developer.okta.com/>Okta</a>.</p><p>Shown below is an overview of the application components and their interaction during OIDC login:</p><p><img loading=lazy src=img/app.png alt=setup></p><ol><li>The user decides to login and issues a request to initiate the flow</li><li>The response redirects to the identity provider</li><li>The IDP login is loaded, where the user enters credentials</li><li>Upon successful IDP login, the user is redirected to a callback-endpoint of the app (including a one-time code)</li><li>The user issues the callback request (including the one-time code)</li><li>The app backend makes a secure back-channel request to exchange the user-related one-time code for an ID-token (together with an app-specific, pre-configured client-secret)</li><li>The IDP returns an ID-token containing user information</li><li>The app backend creates a new JWT containing the app-internal user ID and returns the JWT as an http-only cookie as part of a redirecting response</li><li>The browser then sends the cookie with every API request, allowing the backend to validate the JWT and the permission of the user to access requested resources</li></ol><p>During <em>logout</em> the user needs to clear the existing IDP session as well as the app session, which can be achieved by a series of redirects between the logout endpoints.</p><p>See e.g. <a href=https://youtu.be/996OiexHze0>this presentation</a> for an in-depth explanation of OAuth 2 and OIDC.</p><h3 id=heroku>Heroku<a hidden class=anchor aria-hidden=true href=#heroku>#</a></h3><p><a href=https://www.heroku.com/>Heroku</a> is a platform-as-service which offers a simple way to run an app in the cloud, including a free tier of 550 micro instance-hours per month and a postgres-database with a 10k row limit.
Applications can be provided e.g. in form of jars or docker images (the latter may require custom processing of the environment variable storing the Database credentials).
After 30 mins of inactivity without incoming requests, an instance is put to sleep and stops consuming instance-hours.
To quickly respond to a request when waking up an instance, the usage of a <a href=https://guides.micronaut.io/micronaut-creating-first-graal-app/guide/index.html>native image</a> of the app can be beneficial (reducing the app startup time from ~4.1 seconds to ~0.24s).</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://fladdimir.github.io/tags/java/>Java</a></li><li><a href=https://fladdimir.github.io/tags/micronaut/>Micronaut</a></li><li><a href=https://fladdimir.github.io/tags/oauth/>OAuth</a></li><li><a href=https://fladdimir.github.io/tags/react/>React</a></li><li><a href=https://fladdimir.github.io/tags/leaflet.js/>Leaflet.js</a></li></ul><nav class=paginav><a class=prev href=https://fladdimir.github.io/post/camunda-task-list/><span class=title>« Prev</span><br><span>Camunda Morning Task-List</span></a>
<a class=next href=https://fladdimir.github.io/post/csa4j+cs/><span class=title>Next »</span><br><span>Block-based Modeling with SimPy - in Java & C#</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2022 <a href=https://fladdimir.github.io/>WH</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>